<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediaFlow - Local Media Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            overflow-x: hidden;
        }

        .app {
            min-height: 100vh;
            transition: all 0.5s ease;
        }

        .light {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: #1f2937;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 40;
            background: rgba(17, 24, 39, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease;
        }

        .light .header {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .header.hidden {
            transform: translateY(-100%);
        }

        .header-content {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 448px;
            margin: 0 auto;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #3b82f6;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #3b82f6;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Main Content */
        .main {
            padding-top: 80px;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .reels-mode .main {
            padding-top: 0;
            padding-bottom: 0;
        }

        /* Navigation */
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 50;
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .light .navigation {
            background: rgba(255, 255, 255, 0.8);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .navigation.minimized {
            transform: translateY(8px) scale(0.75);
            opacity: 0.5;
        }

        .nav-content {
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 12px 0;
        }

        .nav-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 24px;
            border-radius: 12px;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-button:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.1);
        }

        .light .nav-button:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .nav-button.active {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.2);
        }

        .nav-button svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
            transition: all 0.3s ease;
        }

        .nav-button.active svg {
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5));
        }

        .nav-button span {
            font-size: 12px;
            font-weight: 500;
        }

        .nav-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            width: 4px;
            height: 4px;
            background: #3b82f6;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Feed Styles */
        .feed {
            padding-bottom: 80px;
        }

        .feed-item {
            margin-bottom: 24px;
            background: #000;
            border-radius: 0;
        }

        .light .feed-item {
            background: #fff;
        }

        .feed-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
        }

        .feed-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .feed-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .feed-user-info h3 {
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .light .feed-user-info h3 {
            color: #000;
        }

        .feed-user-info p {
            font-size: 12px;
            color: #9ca3af;
        }

        .light .feed-user-info p {
            color: #6b7280;
        }

        .feed-more {
            position: relative;
        }

        .feed-more-btn {
            padding: 8px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
        }

        .light .feed-more-btn {
            color: #000;
        }

        .feed-info-popup {
            position: absolute;
            right: 0;
            top: 40px;
            z-index: 10;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            min-width: 256px;
            background: #374151;
            color: white;
            border: 1px solid #4b5563;
        }

        .light .feed-info-popup {
            background: white;
            color: #000;
            border: 1px solid #d1d5db;
        }

        .feed-info-popup h3 {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .feed-info-popup .info-item {
            margin-bottom: 4px;
            font-size: 14px;
        }

        .feed-info-popup .info-label {
            font-weight: 500;
        }

        .feed-media {
            position: relative;
            width: 100%;
            aspect-ratio: 1;
            cursor: pointer;
        }

        .feed-media img,
        .feed-media video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .feed-video-controls {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            color: white;
            border: none;
            cursor: pointer;
        }

        .feed-actions {
            padding: 16px;
        }

        .feed-buttons {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .feed-buttons-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .feed-action-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .light .feed-action-btn {
            color: #000;
        }

        .feed-action-btn:hover {
            transform: scale(1.25);
        }

        .feed-action-btn.liked {
            color: #ef4444;
        }

        .feed-action-btn.liked svg {
            fill: #ef4444;
        }

        .feed-likes {
            margin-bottom: 8px;
        }

        .feed-likes p {
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .light .feed-likes p {
            color: #000;
        }

        .feed-caption {
            margin-bottom: 8px;
        }

        .feed-caption p {
            font-size: 14px;
            color: white;
        }

        .light .feed-caption p {
            color: #000;
        }

        .feed-caption .username {
            font-weight: 600;
        }

        .feed-meta {
            font-size: 12px;
            color: #6b7280;
        }

        .light .feed-meta {
            color: #9ca3af;
        }

        /* Reels Styles */
        .reels {
            position: relative;
            height: 100vh;
            width: 100%;
            overflow: hidden;
            background: #000;
        }

        .reels-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease-out;
        }

        .reels-container.slide-up {
            transform: translateY(-100%);
        }

        .reels-container.slide-down {
            transform: translateY(100%);
        }

        .reels-media {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .reels-preview {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reels-preview.slide-up {
            transform: translateY(100%);
            animation: slideUpIn 0.3s ease-out forwards;
        }

        .reels-preview.slide-down {
            transform: translateY(-100%);
            animation: slideDownIn 0.3s ease-out forwards;
        }

        @keyframes slideUpIn {
            to { transform: translateY(0); }
        }

        @keyframes slideDownIn {
            to { transform: translateY(0); }
        }

        .reels-controls {
            position: absolute;
            bottom: 96px;
            right: 16px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            z-index: 10;
        }

        .reels-control {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .reels-control-btn {
            padding: 12px;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .reels-control-btn:hover {
            transform: scale(1.25);
        }

        .reels-control-btn.liked {
            color: #ef4444;
        }

        .reels-control-btn.liked svg {
            fill: #ef4444;
        }

        .reels-control span {
            color: white;
            font-size: 12px;
            margin-top: 4px;
            font-weight: 500;
        }

        .reels-info {
            position: absolute;
            bottom: 96px;
            left: 16px;
            max-width: 320px;
            z-index: 10;
            color: white;
        }

        .reels-user {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .reels-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .reels-username {
            font-weight: 600;
        }

        .reels-caption {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .reels-meta {
            font-size: 12px;
            opacity: 0.7;
        }

        .reels-position {
            position: absolute;
            top: 16px;
            left: 16px;
            z-index: 10;
            color: white;
            font-size: 14px;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(4px);
            border-radius: 20px;
            padding: 8px 12px;
        }

        /* Account Styles */
        .account {
            padding: 0 16px 96px 16px;
            min-height: 100vh;
            background: linear-gradient(135deg, #111827, #374151, #111827);
        }

        .light .account {
            background: linear-gradient(135deg, #f9fafb, #ffffff, #f3f4f6);
            color: #111827;
        }

        .account-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 0;
            margin-bottom: 24px;
        }

        .account-header h1 {
            font-size: 24px;
            font-weight: bold;
        }

        .settings-btn {
            padding: 12px;
            border-radius: 16px;
            background: rgba(55, 65, 81, 0.5);
            border: 1px solid rgba(55, 65, 81, 0.5);
            color: #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .light .settings-btn {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(209, 213, 219, 0.5);
            color: #6b7280;
        }

        .settings-btn:hover {
            transform: scale(1.1);
            background: rgba(55, 65, 81, 0.5);
            color: white;
        }

        .light .settings-btn:hover {
            background: rgba(243, 244, 246, 0.5);
            color: #111827;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }

        .stat-card {
            padding: 24px;
            border-radius: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .stat-card:hover {
            transform: scale(1.05);
        }

        .stat-card.images {
            background: linear-gradient(135deg, rgba(29, 78, 216, 0.2), rgba(29, 78, 216, 0.1));
            border-color: rgba(29, 78, 216, 0.3);
        }

        .light .stat-card.images {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 197, 253, 0.1));
            border-color: rgba(59, 130, 246, 0.2);
        }

        .stat-card.videos {
            background: linear-gradient(135deg, rgba(220, 38, 38, 0.2), rgba(220, 38, 38, 0.1));
            border-color: rgba(220, 38, 38, 0.3);
        }

        .light .stat-card.videos {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(252, 165, 165, 0.1));
            border-color: rgba(239, 68, 68, 0.2);
        }

        .stat-card.storage {
            background: linear-gradient(135deg, rgba(5, 150, 105, 0.2), rgba(5, 150, 105, 0.1));
            border-color: rgba(5, 150, 105, 0.3);
        }

        .light .stat-card.storage {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(167, 243, 208, 0.1));
            border-color: rgba(16, 185, 129, 0.2);
        }

        .stat-card.favorites {
            background: linear-gradient(135deg, rgba(219, 39, 119, 0.2), rgba(219, 39, 119, 0.1));
            border-color: rgba(219, 39, 119, 0.3);
        }

        .light .stat-card.favorites {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(251, 207, 232, 0.1));
            border-color: rgba(236, 72, 153, 0.2);
        }

        .stat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .stat-icon {
            padding: 8px;
            border-radius: 12px;
            background: rgba(59, 130, 246, 0.2);
        }

        .stat-card.images .stat-icon {
            background: rgba(59, 130, 246, 0.2);
        }

        .stat-card.videos .stat-icon {
            background: rgba(239, 68, 68, 0.2);
        }

        .stat-card.storage .stat-icon {
            background: rgba(16, 185, 129, 0.2);
        }

        .stat-card.favorites .stat-icon {
            background: rgba(236, 72, 153, 0.2);
        }

        .stat-label {
            font-size: 14px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .stat-meta {
            font-size: 12px;
            color: #9ca3af;
        }

        .light .stat-meta {
            color: #6b7280;
        }

        .quick-stats {
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 32px;
            background: linear-gradient(to right, rgba(55, 65, 81, 0.5), rgba(75, 85, 99, 0.3));
            border: 1px solid rgba(55, 65, 81, 0.5);
            backdrop-filter: blur(4px);
        }

        .light .quick-stats {
            background: linear-gradient(to right, rgba(243, 244, 246, 0.5), rgba(255, 255, 255, 0.5));
            border: 1px solid rgba(209, 213, 219, 0.5);
        }

        .quick-stats-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            font-size: 18px;
            font-weight: bold;
        }

        .quick-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .quick-stat {
            text-align: center;
        }

        .quick-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #8b5cf6;
        }

        .quick-stat.avg .quick-stat-value {
            color: #3b82f6;
        }

        .quick-stat.liked .quick-stat-value {
            color: #10b981;
        }

        .quick-stat-label {
            font-size: 12px;
            color: #9ca3af;
        }

        .light .quick-stat-label {
            color: #6b7280;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: bold;
        }

        .section-badge {
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 20px;
            background: rgba(168, 85, 247, 0.2);
            color: #a855f7;
        }

        .light .section-badge {
            background: rgba(147, 51, 234, 0.1);
            color: #7c3aed;
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .media-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 16px;
            overflow: hidden;
            background: rgba(55, 65, 81, 0.3);
            backdrop-filter: blur(4px);
            transition: all 0.3s ease;
        }

        .light .media-item {
            background: rgba(229, 231, 235, 0.3);
        }

        .media-item:hover {
            transform: scale(1.05);
        }

        .media-item img,
        .media-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .media-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.6), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .media-item:hover .media-overlay {
            opacity: 1;
        }

        .media-title {
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            color: white;
            font-size: 12px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .media-item:hover .media-title {
            opacity: 1;
        }

        .media-type {
            position: absolute;
            top: 8px;
            right: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .media-item:hover .media-type {
            opacity: 1;
        }

        .media-type-icon {
            padding: 4px;
            border-radius: 50%;
            background: #3b82f6;
        }

        .media-type-icon.video {
            background: #ef4444;
        }

        .media-favorite {
            position: absolute;
            top: 8px;
            left: 8px;
        }

        .media-favorite svg {
            width: 16px;
            height: 16px;
            color: #ef4444;
            fill: #ef4444;
        }

        .recent-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .recent-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border-radius: 16px;
            background: rgba(55, 65, 81, 0.3);
            border: 1px solid rgba(55, 65, 81, 0.3);
            backdrop-filter: blur(4px);
            transition: all 0.3s ease;
        }

        .light .recent-item {
            background: rgba(243, 244, 246, 0.5);
            border: 1px solid rgba(209, 213, 219, 0.3);
        }

        .recent-item:hover {
            transform: scale(1.02);
            background: rgba(55, 65, 81, 0.5);
        }

        .light .recent-item:hover {
            background: rgba(229, 231, 235, 0.5);
        }

        .recent-thumbnail {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .recent-thumbnail img,
        .recent-thumbnail video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .recent-info {
            flex: 1;
            min-width: 0;
        }

        .recent-name {
            font-weight: 600;
            font-size: 18px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .recent-meta {
            font-size: 14px;
            color: #9ca3af;
            margin-bottom: 4px;
        }

        .light .recent-meta {
            color: #6b7280;
        }

        .recent-badges {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        .recent-badge {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 20px;
        }

        .recent-badge.image {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .light .recent-badge.image {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
        }

        .recent-badge.video {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        .light .recent-badge.video {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .recent-favorite {
            margin-left: 8px;
        }

        .recent-favorite svg {
            width: 12px;
            height: 12px;
            color: #ef4444;
            fill: #ef4444;
        }

        .recent-type {
            flex-shrink: 0;
        }

        .recent-type svg {
            width: 20px;
            height: 20px;
            color: #3b82f6;
        }

        .recent-type.video svg {
            color: #ef4444;
        }

        /* Settings Styles */
        .settings {
            padding: 0 16px 80px 16px;
            color: white;
        }

        .light .settings {
            color: #111827;
        }

        .settings-header {
            text-align: center;
            padding: 32px 0;
        }

        .settings-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .settings-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .settings-subtitle {
            font-size: 14px;
            color: #9ca3af;
        }

        .light .settings-subtitle {
            color: #6b7280;
        }

        .settings-sections {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .settings-section {
            padding: 24px;
            border-radius: 16px;
            background: rgba(55, 65, 81, 0.5);
            backdrop-filter: blur(4px);
        }

        .light .settings-section {
            background: rgba(243, 244, 246, 1);
        }

        .settings-section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .settings-section-title {
            font-size: 18px;
            font-weight: 600;
        }

        .settings-section-desc {
            font-size: 14px;
            color: #9ca3af;
            margin-bottom: 16px;
        }

        .light .settings-section-desc {
            color: #6b7280;
        }

        .settings-button {
            width: 100%;
            padding: 12px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-button:hover {
            background: #2563eb;
            transform: scale(1.05);
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .theme-option {
            padding: 16px;
            border-radius: 12px;
            border: 2px solid transparent;
            background: none;
            color: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .theme-option:hover {
            border-color: #6b7280;
        }

        .light .theme-option:hover {
            border-color: #9ca3af;
        }

        .theme-option.active {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.2);
        }

        .theme-option svg {
            width: 24px;
            height: 24px;
            margin: 0 auto 8px;
        }

        .theme-option span {
            font-size: 14px;
            font-weight: 500;
        }

        .settings-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-toggle-info h3 {
            font-weight: 500;
            margin-bottom: 4px;
        }

        .settings-toggle-info p {
            font-size: 14px;
            color: #9ca3af;
        }

        .light .settings-toggle-info p {
            color: #6b7280;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 24px;
            border-radius: 12px;
            background: #6b7280;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .toggle-switch.active {
            background: #10b981;
        }

        .toggle-slider {
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        /* Fullscreen Media Viewer */
        .fullscreen-viewer {
            position: fixed;
            inset: 0;
            z-index: 50;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-close {
            position: absolute;
            top: 16px;
            left: 16px;
            z-index: 10;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fullscreen-close:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .fullscreen-media {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-media img,
        .fullscreen-media video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .fullscreen-audio {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            color: white;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .fullscreen-audio:hover {
            transform: scale(1.1);
        }

        .fullscreen-controls {
            position: absolute;
            bottom: 32px;
            left: 32px;
            right: 32px;
            transition: all 0.3s ease;
        }

        .fullscreen-controls.hidden {
            opacity: 0;
        }

        .fullscreen-seekbar {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            border-radius: 12px;
            padding: 16px;
        }

        .fullscreen-seek-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .fullscreen-time {
            color: white;
            font-size: 14px;
            font-family: monospace;
            min-width: 40px;
        }

        .fullscreen-seek {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            appearance: none;
            cursor: pointer;
            outline: none;
        }

        .fullscreen-seek::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .fullscreen-seek::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Empty States */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 32px;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .empty-desc {
            font-size: 14px;
            color: #9ca3af;
        }

        .light .empty-desc {
            color: #6b7280;
        }

        /* Back Button */
        .back-button {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 50;
            padding: 12px;
            border-radius: 50%;
            background: rgba(55, 65, 81, 0.8);
            border: 1px solid rgba(55, 65, 81, 0.5);
            color: #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(4px);
        }

        .light .back-button {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(209, 213, 219, 0.5);
            color: #6b7280;
        }

        .back-button:hover {
            transform: scale(1.1);
            background: rgba(55, 65, 81, 0.8);
            color: white;
        }

        .light .back-button:hover {
            background: rgba(243, 244, 246, 0.8);
            color: #111827;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .media-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-stats-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0; }
    </style>
</head>
<body>
    <div id="app" class="app">
        <!-- Header -->
        <header id="header" class="header">
            <div class="header-content">
                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <span>Loading...</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main" class="main">
            <!-- Feed View -->
            <div id="feed-view" class="feed"></div>

            <!-- Reels View -->
            <div id="reels-view" class="reels hidden"></div>

            <!-- Account View -->
            <div id="account-view" class="account hidden"></div>

            <!-- Settings View -->
            <div id="settings-view" class="settings hidden"></div>
        </main>

        <!-- Navigation -->
        <nav id="navigation" class="navigation">
            <div class="nav-content">
                <button class="nav-button active" data-tab="feed">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9,22 9,12 15,12 15,22"/>
                    </svg>
                    <span>Feed</span>
                </button>
                <button class="nav-button" data-tab="reels">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5,3 19,12 5,21 5,3"/>
                    </svg>
                    <span>Reels</span>
                </button>
                <button class="nav-button" data-tab="account">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span>Account</span>
                </button>
            </div>
        </nav>

        <!-- Fullscreen Media Viewer -->
        <div id="fullscreen-viewer" class="fullscreen-viewer hidden">
            <button id="fullscreen-close" class="fullscreen-close">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            <div id="fullscreen-media" class="fullscreen-media"></div>
            <button id="fullscreen-audio" class="fullscreen-audio hidden">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                    <path d="m19.07 4.93-1.41 1.41A8.5 8.5 0 0 1 19.07 19.07l1.41 1.41A10.5 10.5 0 0 0 19.07 4.93z"/>
                    <path d="m15.54 8.46-1.41 1.41A4.5 4.5 0 0 1 15.54 15.54l1.41 1.41A6.5 6.5 0 0 0 15.54 8.46z"/>
                </svg>
            </button>
            <div id="fullscreen-controls" class="fullscreen-controls hidden">
                <div class="fullscreen-seekbar">
                    <div class="fullscreen-seek-container">
                        <span id="current-time" class="fullscreen-time">0:00</span>
                        <input type="range" id="seek-bar" class="fullscreen-seek" min="0" max="0" value="0">
                        <span id="duration-time" class="fullscreen-time">0:00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Back Button -->
        <button id="back-button" class="back-button hidden">←</button>
    </div>

    <script>
        // Application State
        let state = {
            activeTab: 'feed',
            mediaItems: [],
            settings: {
                theme: 'dark',
                folderPath: '',
                autoplay: true,
                soundEnabled: true,
                showFeedButtons: false,
                showReelsInfo: true
            },
            stats: {
                totalMedia: 0,
                totalImages: 0,
                totalVideos: 0,
                totalSize: 0,
                favoriteItems: []
            },
            loading: false,
            showSettings: false,
            fullscreenItem: null,
            currentReelIndex: 0,
            mutedVideos: new Set(),
            playingVideos: new Set(),
            showInfoPopup: null,
            soundEnabled: true,
            isTransitioning: false,
            slideDirection: null
        };

        // DOM Elements
        const app = document.getElementById('app');
        const header = document.getElementById('header');
        const main = document.getElementById('main');
        const navigation = document.getElementById('navigation');
        const loading = document.getElementById('loading');
        const feedView = document.getElementById('feed-view');
        const reelsView = document.getElementById('reels-view');
        const accountView = document.getElementById('account-view');
        const settingsView = document.getElementById('settings-view');
        const fullscreenViewer = document.getElementById('fullscreen-viewer');
        const backButton = document.getElementById('back-button');

        // Utility Functions
        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatTime(time) {
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60);
            return `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function generateId(name, lastModified) {
            return `${name}-${lastModified}`;
        }

        // Theme Management
        function applyTheme() {
            const theme = state.settings.theme === 'auto' 
                ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
                : state.settings.theme;
            
            app.className = theme === 'dark' ? 'app' : 'app light';
            
            if (theme === 'dark') {
                document.body.style.background = 'linear-gradient(135deg, #0f172a 0%, #1e293b 100%)';
            } else {
                document.body.style.background = 'linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)';
            }
        }

        // Media Loading
        async function loadFolderContents() {
            try {
                state.loading = true;
                updateLoadingState();
                
                if ('showDirectoryPicker' in window && window.self === window.top) {
                    const dirHandle = await window.showDirectoryPicker();
                    const files = [];
                    
                    for await (const [name, fileHandle] of dirHandle.entries()) {
                        if (fileHandle.kind === 'file') {
                            const file = await fileHandle.getFile();
                            const isImage = file.type.startsWith('image/');
                            const isVideo = file.type.startsWith('video/');
                            
                            if (isImage || isVideo) {
                                const url = URL.createObjectURL(file);
                                files.push({
                                    id: generateId(file.name, file.lastModified),
                                    name: file.name,
                                    type: isImage ? 'image' : 'video',
                                    url,
                                    file,
                                    size: file.size,
                                    lastModified: file.lastModified
                                });
                            }
                        }
                    }
                    
                    // Shuffle array for random display
                    const shuffled = files.sort(() => Math.random() - 0.5);
                    state.mediaItems = shuffled;
                    updateStats();
                    renderCurrentView();
                } else {
                    // Fallback: Use regular file input
                    const input = document.createElement('input');
                    input.type = 'file';
                    input.multiple = true;
                    input.accept = 'image/*,video/*';
                    input.webkitdirectory = true;
                    
                    input.onchange = (e) => {
                        const files = Array.from(e.target.files || []);
                        const mediaFiles = [];
                        
                        files.forEach(file => {
                            const isImage = file.type.startsWith('image/');
                            const isVideo = file.type.startsWith('video/');
                            
                            if (isImage || isVideo) {
                                const url = URL.createObjectURL(file);
                                mediaFiles.push({
                                    id: generateId(file.name, file.lastModified),
                                    name: file.name,
                                    type: isImage ? 'image' : 'video',
                                    url,
                                    file,
                                    size: file.size,
                                    lastModified: file.lastModified
                                });
                            }
                        });
                        
                        // Shuffle array for random display
                        const shuffled = mediaFiles.sort(() => Math.random() - 0.5);
                        state.mediaItems = shuffled;
                        updateStats();
                        renderCurrentView();
                    };
                    
                    input.click();
                }
                
            } catch (error) {
                console.error('Error loading folder:', error);
            } finally {
                state.loading = false;
                updateLoadingState();
            }
        }

        function updateStats() {
            state.stats = {
                totalMedia: state.mediaItems.length,
                totalImages: state.mediaItems.filter(item => item.type === 'image').length,
                totalVideos: state.mediaItems.filter(item => item.type === 'video').length,
                totalSize: state.mediaItems.reduce((sum, item) => sum + item.size, 0),
                favoriteItems: state.stats.favoriteItems
            };
        }

        function updateLoadingState() {
            if (state.loading) {
                loading.classList.remove('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        // Navigation
        function setActiveTab(tab) {
            state.activeTab = tab;
            state.showSettings = false;
            
            // Update navigation buttons
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                }
            });
            
            // Update app classes for reels mode
            if (tab === 'reels') {
                app.classList.add('reels-mode');
                header.classList.add('hidden');
                navigation.classList.add('minimized');
            } else {
                app.classList.remove('reels-mode');
                header.classList.remove('hidden');
                navigation.classList.remove('minimized');
            }
            
            renderCurrentView();
        }

        function showSettings() {
            state.showSettings = true;
            backButton.classList.remove('hidden');
            renderCurrentView();
        }

        function hideSettings() {
            state.showSettings = false;
            backButton.classList.add('hidden');
            renderCurrentView();
        }

        // Favorites
        function toggleFavorite(itemId) {
            if (state.stats.favoriteItems.includes(itemId)) {
                state.stats.favoriteItems = state.stats.favoriteItems.filter(id => id !== itemId);
            } else {
                state.stats.favoriteItems.push(itemId);
            }
            renderCurrentView();
        }

        // Feed Functions
        function renderFeed() {
            if (state.mediaItems.length === 0) {
                feedView.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📁</div>
                        <p class="empty-title">No media files found</p>
                        <p class="empty-desc">Select a folder from settings to start viewing your photos and videos</p>
                    </div>
                `;
                return;
            }

            feedView.innerHTML = state.mediaItems.map(item => `
                <div class="feed-item">
                    <div class="feed-header">
                        <div class="feed-user">
                            <div class="feed-avatar">M</div>
                            <div class="feed-user-info">
                                <h3>My Media</h3>
                                <p>${new Date(item.lastModified).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="feed-more">
                            <button class="feed-more-btn" onclick="toggleInfoPopup('${item.id}')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="19" cy="12" r="1"/>
                                    <circle cx="5" cy="12" r="1"/>
                                </svg>
                            </button>
                            ${state.showInfoPopup === item.id ? `
                                <div class="feed-info-popup">
                                    <h3>Media Information</h3>
                                    <div class="info-item"><span class="info-label">Name:</span> ${item.name}</div>
                                    <div class="info-item"><span class="info-label">Type:</span> ${item.type.toUpperCase()}</div>
                                    <div class="info-item"><span class="info-label">Size:</span> ${formatBytes(item.size)}</div>
                                    <div class="info-item"><span class="info-label">Modified:</span> ${new Date(item.lastModified).toLocaleString()}</div>
                                    ${item.dimensions ? `<div class="info-item"><span class="info-label">Dimensions:</span> ${item.dimensions.width} × ${item.dimensions.height}</div>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    <div class="feed-media" onclick="openFullscreen('${item.id}')">
                        ${item.type === 'image' ? `
                            <img src="${item.url}" alt="${item.name}" loading="lazy">
                        ` : `
                            <video 
                                src="${item.url}" 
                                muted 
                                loop 
                                playsInline 
                                preload="metadata"
                                data-video-id="${item.id}"
                            ></video>
                            <button class="feed-video-controls" onclick="event.stopPropagation(); toggleVideoMute('${item.id}')">
                                ${state.mutedVideos.has(item.id) ? `
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                        <line x1="23" y1="9" x2="17" y2="15"/>
                                        <line x1="17" y1="9" x2="23" y2="15"/>
                                    </svg>
                                ` : `
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                        <path d="m19.07 4.93-1.41 1.41A8.5 8.5 0 0 1 19.07 19.07l1.41 1.41A10.5 10.5 0 0 0 19.07 4.93z"/>
                                        <path d="m15.54 8.46-1.41 1.41A4.5 4.5 0 0 1 15.54 15.54l1.41 1.41A6.5 6.5 0 0 0 15.54 8.46z"/>
                                    </svg>
                                `}
                            </button>
                        `}
                    </div>
                    <div class="feed-actions">
                        <div class="feed-buttons">
                            <div class="feed-buttons-left">
                                <button class="feed-action-btn ${state.stats.favoriteItems.includes(item.id) ? 'liked' : ''}" onclick="toggleFavorite('${item.id}')">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="m19 14 1.5-1.5c.8-.8.8-2.1 0-2.8L12 1.2 3.5 9.7c-.8.8-.8 2.1 0 2.8L5 14l7-7 7 7z"/>
                                    </svg>
                                </button>
                                ${state.settings.showFeedButtons ? `
                                    <button class="feed-action-btn">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/>
                                        </svg>
                                    </button>
                                    <button class="feed-action-btn">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <line x1="22" y1="2" x2="11" y2="13"/>
                                            <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                                        </svg>
                                    </button>
                                ` : ''}
                            </div>
                            ${state.settings.showFeedButtons ? `
                                <button class="feed-action-btn">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z"/>
                                    </svg>
                                </button>
                            ` : ''}
                        </div>
                        <div class="feed-likes">
                            <p>${Math.floor(Math.random() * 1000) + 1} likes</p>
                        </div>
                        <div class="feed-caption">
                            <p><span class="username">My Media</span> ${item.name}</p>
                        </div>
                        <p class="feed-meta">${(item.size / 1024 / 1024).toFixed(1)} MB • ${item.type.toUpperCase()}</p>
                    </div>
                </div>
            `).join('');

            // Setup intersection observer for videos
            setupVideoIntersectionObserver();
        }

        function setupVideoIntersectionObserver() {
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        const video = entry.target;
                        const videoId = video.getAttribute('data-video-id');
                        
                        if (entry.isIntersecting && entry.intersectionRatio > 0.5) {
                            video.play().catch(() => {});
                            state.playingVideos.add(videoId);
                        } else {
                            video.pause();
                            state.playingVideos.delete(videoId);
                        }
                    });
                },
                {
                    threshold: 0.5,
                    rootMargin: '0px'
                }
            );

            document.querySelectorAll('video[data-video-id]').forEach(video => {
                observer.observe(video);
            });
        }

        function toggleVideoMute(itemId) {
            if (state.mutedVideos.has(itemId)) {
                state.mutedVideos.delete(itemId);
            } else {
                state.mutedVideos.add(itemId);
            }
            
            const video = document.querySelector(`video[data-video-id="${itemId}"]`);
            if (video) {
                video.muted = state.mutedVideos.has(itemId);
            }
            
            renderCurrentView();
        }

        function toggleInfoPopup(itemId) {
            state.showInfoPopup = state.showInfoPopup === itemId ? null : itemId;
            renderCurrentView();
        }

        // Reels Functions
        function renderReels() {
            if (state.mediaItems.length === 0) {
                reelsView.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🎬</div>
                        <p class="empty-title">No media to show</p>
                        <p class="empty-desc">Add some photos and videos to your selected folder</p>
                    </div>
                `;
                return;
            }

            const currentItem = state.mediaItems[state.currentReelIndex];
            
            reelsView.innerHTML = `
                <div class="reels-container ${state.slideDirection ? `slide-${state.slideDirection}` : ''}">
                    ${currentItem.type === 'image' ? `
                        <img src="${currentItem.url}" alt="${currentItem.name}" class="reels-media">
                    ` : `
                        <video 
                            src="${currentItem.url}" 
                            class="reels-media" 
                            autoplay 
                            loop 
                            muted="${!state.soundEnabled}"
                            playsinline
                            onclick="toggleVideoPlayPause()"
                        ></video>
                    `}
                </div>

                ${state.slideDirection === 'up' && state.currentReelIndex < state.mediaItems.length - 1 ? `
                    <div class="reels-preview slide-up">
                        ${state.mediaItems[state.currentReelIndex + 1].type === 'image' ? `
                            <img src="${state.mediaItems[state.currentReelIndex + 1].url}" alt="${state.mediaItems[state.currentReelIndex + 1].name}" class="reels-media">
                        ` : `
                            <video src="${state.mediaItems[state.currentReelIndex + 1].url}" class="reels-media" muted playsinline></video>
                        `}
                    </div>
                ` : ''}

                ${state.slideDirection === 'down' && state.currentReelIndex > 0 ? `
                    <div class="reels-preview slide-down">
                        ${state.mediaItems[state.currentReelIndex - 1].type === 'image' ? `
                            <img src="${state.mediaItems[state.currentReelIndex - 1].url}" alt="${state.mediaItems[state.currentReelIndex - 1].name}" class="reels-media">
                        ` : `
                            <video src="${state.mediaItems[state.currentReelIndex - 1].url}" class="reels-media" muted playsinline></video>
                        `}
                    </div>
                ` : ''}

                <div class="reels-controls">
                    <div class="reels-control">
                        <button class="reels-control-btn ${state.stats.favoriteItems.includes(currentItem.id) ? 'liked' : ''}" onclick="toggleFavorite('${currentItem.id}')">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="m19 14 1.5-1.5c.8-.8.8-2.1 0-2.8L12 1.2 3.5 9.7c-.8.8-.8 2.1 0 2.8L5 14l7-7 7 7z"/>
                            </svg>
                        </button>
                        <span>${Math.floor(Math.random() * 1000) + 1}</span>
                    </div>
                    
                    ${currentItem.type === 'video' ? `
                        <div class="reels-control">
                            <button class="reels-control-btn" onclick="toggleReelsSound()">
                                ${state.soundEnabled ? `
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                        <path d="m19.07 4.93-1.41 1.41A8.5 8.5 0 0 1 19.07 19.07l1.41 1.41A10.5 10.5 0 0 0 19.07 4.93z"/>
                                        <path d="m15.54 8.46-1.41 1.41A4.5 4.5 0 0 1 15.54 15.54l1.41 1.41A6.5 6.5 0 0 0 15.54 8.46z"/>
                                    </svg>
                                ` : `
                                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                        <line x1="23" y1="9" x2="17" y2="15"/>
                                        <line x1="17" y1="9" x2="23" y2="15"/>
                                    </svg>
                                `}
                            </button>
                        </div>
                    ` : ''}
                </div>

                ${state.settings.showReelsInfo ? `
                    <div class="reels-info">
                        <div class="reels-user">
                            <div class="reels-avatar">M</div>
                            <span class="reels-username">My Media</span>
                        </div>
                        <p class="reels-caption">${currentItem.name}</p>
                        <p class="reels-meta">${(currentItem.size / 1024 / 1024).toFixed(1)} MB • ${currentItem.type.toUpperCase()}</p>
                    </div>
                ` : ''}

                <div class="reels-position">
                    ${state.currentReelIndex + 1} / ${state.mediaItems.length}
                </div>
            `;

            setupReelsGestures();
        }

        function setupReelsGestures() {
            let startY = 0;
            let isDragging = false;

            reelsView.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                isDragging = true;
            });

            reelsView.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
            });

            reelsView.addEventListener('touchend', (e) => {
                if (!isDragging) return;
                isDragging = false;
                
                const endY = e.changedTouches[0].clientY;
                const deltaY = startY - endY;
                const threshold = 50;

                if (Math.abs(deltaY) > threshold) {
                    if (deltaY > 0) {
                        goToNextReel();
                    } else {
                        goToPreviousReel();
                    }
                }
            });

            reelsView.addEventListener('wheel', (e) => {
                e.preventDefault();
                if (e.deltaY > 0) {
                    goToNextReel();
                } else {
                    goToPreviousReel();
                }
            });
        }

        function goToNextReel() {
            if (state.currentReelIndex < state.mediaItems.length - 1 && !state.isTransitioning) {
                state.isTransitioning = true;
                state.slideDirection = 'up';
                setTimeout(() => {
                    state.currentReelIndex++;
                    state.slideDirection = null;
                    state.isTransitioning = false;
                    renderReels();
                }, 150);
                renderReels();
            }
        }

        function goToPreviousReel() {
            if (state.currentReelIndex > 0 && !state.isTransitioning) {
                state.isTransitioning = true;
                state.slideDirection = 'down';
                setTimeout(() => {
                    state.currentReelIndex--;
                    state.slideDirection = null;
                    state.isTransitioning = false;
                    renderReels();
                }, 150);
                renderReels();
            }
        }

        function toggleVideoPlayPause() {
            const video = reelsView.querySelector('video');
            if (video) {
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            }
        }

        function toggleReelsSound() {
            state.soundEnabled = !state.soundEnabled;
            const video = reelsView.querySelector('video');
            if (video) {
                video.muted = !state.soundEnabled;
            }
            renderReels();
        }

        // Account Functions
        function renderAccount() {
            const favoriteItems = state.mediaItems.filter(item => state.stats.favoriteItems.includes(item.id));
            const recentItems = [...state.mediaItems].sort((a, b) => b.lastModified - a.lastModified).slice(0, 6);

            accountView.innerHTML = `
                <div class="account-header">
                    <h1>Account</h1>
                    <button class="settings-btn" onclick="showSettings()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="m12 1 1.27 2.418c.34.646.646 1.08 1.418 1.27L17 6l-1.27 2.418c-.34.646-.646 1.08-1.418 1.27L12 11l-1.27-2.418c-.34-.646-.646-1.08-1.418-1.27L7 6l1.27-2.418c.34-.646.646-1.08 1.418-1.27L12 1"/>
                            <path d="m19 14 .7 1.336c.17.323.323.54.709.635L22 16.5l-.7 1.336c-.17.323-.323.54-.709.635L19 19l-.7-1.336c-.17-.323-.323-.54-.709-.635L16 16.5l.7-1.336c.17-.323.323-.54.709-.635L19 14"/>
                        </svg>
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card images">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #3b82f6;">
                                    <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                                    <circle cx="9" cy="9" r="2"/>
                                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                                </svg>
                            </div>
                            <span class="stat-label">Images</span>
                        </div>
                        <p class="stat-value">${state.stats.totalImages}</p>
                        <p class="stat-meta">${((state.stats.totalImages / state.stats.totalMedia) * 100 || 0).toFixed(0)}% of collection</p>
                    </div>
                    
                    <div class="stat-card videos">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #ef4444;">
                                    <path d="m22 8-6 4 6 4V8Z"/>
                                    <rect width="14" height="12" x="2" y="6" rx="2" ry="2"/>
                                </svg>
                            </div>
                            <span class="stat-label">Videos</span>
                        </div>
                        <p class="stat-value">${state.stats.totalVideos}</p>
                        <p class="stat-meta">${((state.stats.totalVideos / state.stats.totalMedia) * 100 || 0).toFixed(0)}% of collection</p>
                    </div>
                    
                    <div class="stat-card storage">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #10b981;">
                                    <ellipse cx="12" cy="5" rx="9" ry="3"/>
                                    <path d="M3 5v14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"/>
                                    <path d="M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"/>
                                </svg>
                            </div>
                            <span class="stat-label">Storage</span>
                        </div>
                        <p class="stat-value">${formatBytes(state.stats.totalSize)}</p>
                        <p class="stat-meta">Total file size</p>
                    </div>
                    
                    <div class="stat-card favorites">
                        <div class="stat-header">
                            <div class="stat-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #ec4899;">
                                    <path d="m19 14 1.5-1.5c.8-.8.8-2.1 0-2.8L12 1.2 3.5 9.7c-.8.8-.8 2.1 0 2.8L5 14l7-7 7 7z"/>
                                </svg>
                            </div>
                            <span class="stat-label">Favorites</span>
                        </div>
                        <p class="stat-value">${state.stats.favoriteItems.length}</p>
                        <p class="stat-meta">Liked items</p>
                    </div>
                </div>

                <div class="quick-stats">
                    <h3 class="quick-stats-header">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #8b5cf6;">
                            <polyline points="22,12 18,12 15,21 9,3 6,12 2,12"/>
                        </svg>
                        Quick Stats
                    </h3>
                    <div class="quick-stats-grid">
                        <div class="quick-stat">
                            <p class="quick-stat-value">${state.stats.totalMedia}</p>
                            <p class="quick-stat-label">Total Items</p>
                        </div>
                        <div class="quick-stat avg">
                            <p class="quick-stat-value">${state.stats.totalMedia > 0 ? Math.round(state.stats.totalSize / state.stats.totalMedia / 1024 / 1024) : 0}</p>
                            <p class="quick-stat-label">Avg Size (MB)</p>
                        </div>
                        <div class="quick-stat liked">
                            <p class="quick-stat-value">${((state.stats.favoriteItems.length / state.stats.totalMedia) * 100 || 0).toFixed(0)}%</p>
                            <p class="quick-stat-label">Liked</p>
                        </div>
                    </div>
                </div>

                ${favoriteItems.length > 0 ? `
                    <div class="section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #fbbf24;">
                                    <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26 12,2"/>
                                </svg>
                                Favorite Items
                                <span class="section-badge">${favoriteItems.length}</span>
                            </h2>
                        </div>
                        <div class="media-grid">
                            ${favoriteItems.slice(0, 6).map(item => `
                                <div class="media-item">
                                    ${item.type === 'image' ? `
                                        <img src="${item.url}" alt="${item.name}">
                                    ` : `
                                        <video src="${item.url}" muted></video>
                                    `}
                                    <div class="media-overlay"></div>
                                    <div class="media-title">${item.name}</div>
                                    <div class="media-type">
                                        <div class="media-type-icon ${item.type}">
                                            ${item.type === 'image' ? `
                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: white;">
                                                    <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                                                    <circle cx="9" cy="9" r="2"/>
                                                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                                                </svg>
                                            ` : `
                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: white;">
                                                    <path d="m22 8-6 4 6 4V8Z"/>
                                                    <rect width="14" height="12" x="2" y="6" rx="2" ry="2"/>
                                                </svg>
                                            `}
                                        </div>
                                    </div>
                                    <div class="media-favorite">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                                            <path d="m19 14 1.5-1.5c.8-.8.8-2.1 0-2.8L12 1.2 3.5 9.7c-.8.8-.8 2.1 0 2.8L5 14l7-7 7 7z"/>
                                        </svg>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                ${recentItems.length > 0 ? `
                    <div class="section">
                        <div class="section-header">
                            <h2 class="section-title">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #3b82f6;">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12,6 12,12 16,14"/>
                                </svg>
                                Recent Items
                            </h2>
                        </div>
                        <div class="recent-items">
                            ${recentItems.map(item => `
                                <div class="recent-item">
                                    <div class="recent-thumbnail">
                                        ${item.type === 'image' ? `
                                            <img src="${item.url}" alt="${item.name}">
                                        ` : `
                                            <video src="${item.url}" muted></video>
                                        `}
                                    </div>
                                    <div class="recent-info">
                                        <p class="recent-name">${item.name}</p>
                                        <p class="recent-meta">${new Date(item.lastModified).toLocaleDateString()} • ${formatBytes(item.size)}</p>
                                        <div class="recent-badges">
                                            <span class="recent-badge ${item.type}">${item.type.toUpperCase()}</span>
                                            ${state.stats.favoriteItems.includes(item.id) ? `
                                                <div class="recent-favorite">
                                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                                                        <path d="m19 14 1.5-1.5c.8-.8.8-2.1 0-2.8L12 1.2 3.5 9.7c-.8.8-.8 2.1 0 2.8L5 14l7-7 7 7z"/>
                                                    </svg>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                    <div class="recent-type ${item.type}">
                                        ${item.type === 'image' ? `
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                                                <circle cx="9" cy="9" r="2"/>
                                                <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                                            </svg>
                                        ` : `
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="m22 8-6 4 6 4V8Z"/>
                                                <rect width="14" height="12" x="2" y="6" rx="2" ry="2"/>
                                            </svg>
                                        `}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}

                ${state.mediaItems.length > 0 ? `
                    <div class="section">
                        <div class="section-header">
                            <h2 class="section-title">
                                All Media
                                <span class="section-badge">${state.mediaItems.length}</span>
                            </h2>
                        </div>
                        <div class="media-grid">
                            ${state.mediaItems.map(item => `
                                <div class="media-item">
                                    ${item.type === 'image' ? `
                                        <img src="${item.url}" alt="${item.name}">
                                    ` : `
                                        <video src="${item.url}" muted></video>
                                    `}
                                    <div class="media-overlay"></div>
                                    <div class="media-title">${item.name}</div>
                                    <div class="media-type">
                                        <div class="media-type-icon ${item.type}">
                                            ${item.type === 'image' ? `
                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: white;">
                                                    <rect width="18" height="18" x="3" y="3" rx="2" ry="2"/>
                                                    <circle cx="9" cy="9" r="2"/>
                                                    <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/>
                                                </svg>
                                            ` : `
                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: white;">
                                                    <path d="m22 8-6 4 6 4V8Z"/>
                                                    <rect width="14" height="12" x="2" y="6" rx="2" ry="2"/>
                                                </svg>
                                            `}
                                        </div>
                                    </div>
                                    ${state.stats.favoriteItems.includes(item.id) ? `
                                        <div class="media-favorite">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                                                <path d="m19 14 1.5-1.5c.8-.8.8-2.1 0-2.8L12 1.2 3.5 9.7c-.8.8-.8 2.1 0 2.8L5 14l7-7 7 7z"/>
                                            </svg>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
        }

        // Settings Functions
        function renderSettings() {
            settingsView.innerHTML = `
                <div class="settings-header">
                    <div class="settings-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 3a6.364 6.364 0 0 0 9 9 9 9 0 1 1-9-9Z"/>
                        </svg>
                    </div>
                    <h1 class="settings-title">Settings</h1>
                    <p class="settings-subtitle">Customize your experience</p>
                </div>

                <div class="settings-sections">
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #3b82f6;">
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                            </svg>
                            <h2 class="settings-section-title">Media Folder</h2>
                        </div>
                        <p class="settings-section-desc">Select a folder containing your photos and videos</p>
                        <button class="settings-button" onclick="loadFolderContents()">Choose Folder</button>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #8b5cf6;">
                                <circle cx="13.5" cy="6.5" r=".5"/>
                                <circle cx="17.5" cy="10.5" r=".5"/>
                                <circle cx="8.5" cy="7.5" r=".5"/>
                                <circle cx="6.5" cy="11.5" r=".5"/>
                                <circle cx="12.5" cy="13.5" r=".5"/>
                                <circle cx="16.5" cy="17.5" r=".5"/>
                                <circle cx="10.5" cy="16.5" r=".5"/>
                                <circle cx="15.5" cy="14.5" r=".5"/>
                                <circle cx="9.5" cy="19.5" r=".5"/>
                                <circle cx="5.5" cy="15.5" r=".5"/>
                            </svg>
                            <h2 class="settings-section-title">Theme</h2>
                        </div>
                        <div class="theme-options">
                            ${['light', 'dark', 'auto'].map(theme => `
                                <button class="theme-option ${state.settings.theme === theme ? 'active' : ''}" onclick="updateTheme('${theme}')">
                                    ${theme === 'light' ? `
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="5"/>
                                            <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                                        </svg>
                                    ` : theme === 'dark' ? `
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                                        </svg>
                                    ` : `
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect width="20" height="14" x="2" y="3" rx="2"/>
                                            <line x1="8" y1="21" x2="16" y2="21"/>
                                            <line x1="12" y1="17" x2="12" y2="21"/>
                                        </svg>
                                    `}
                                    <span>${theme.charAt(0).toUpperCase() + theme.slice(1)}</span>
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #10b981;">
                                <rect width="7" height="9" x="3" y="3" rx="1"/>
                                <rect width="7" height="5" x="14" y="3" rx="1"/>
                                <rect width="7" height="9" x="14" y="12" rx="1"/>
                                <rect width="7" height="5" x="3" y="16" rx="1"/>
                            </svg>
                            <h2 class="settings-section-title">Feed Options</h2>
                        </div>
                        <div class="settings-toggle">
                            <div class="settings-toggle-info">
                                <h3>Show Share & Save Buttons</h3>
                                <p>Display additional action buttons in feed</p>
                            </div>
                            <div class="toggle-switch ${state.settings.showFeedButtons ? 'active' : ''}" onclick="toggleSetting('showFeedButtons')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #8b5cf6;">
                                <polygon points="5,3 19,12 5,21 5,3"/>
                            </svg>
                            <h2 class="settings-section-title">Reels Options</h2>
                        </div>
                        <div class="settings-toggle">
                            <div class="settings-toggle-info">
                                <h3>Show Media Info</h3>
                                <p>Display media information overlay in reels</p>
                            </div>
                            <div class="toggle-switch ${state.settings.showReelsInfo ? 'active' : ''}" onclick="toggleSetting('showReelsInfo')">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <h2 class="settings-section-title">Media Preferences</h2>
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <div class="settings-toggle">
                                <div class="settings-toggle-info" style="display: flex; align-items: center; gap: 12px;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #ef4444;">
                                        <polygon points="5,3 19,12 5,21 5,3"/>
                                    </svg>
                                    <div>
                                        <h3>Auto-play Videos</h3>
                                        <p>Automatically play videos in feed</p>
                                    </div>
                                </div>
                                <div class="toggle-switch ${state.settings.autoplay ? 'active' : ''}" onclick="toggleSetting('autoplay')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>

                            <div class="settings-toggle">
                                <div class="settings-toggle-info" style="display: flex; align-items: center; gap: 12px;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="color: #3b82f6;">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                        <path d="m19.07 4.93-1.41 1.41A8.5 8.5 0 0 1 19.07 19.07l1.41 1.41A10.5 10.5 0 0 0 19.07 4.93z"/>
                                        <path d="m15.54 8.46-1.41 1.41A4.5 4.5 0 0 1 15.54 15.54l1.41 1.41A6.5 6.5 0 0 0 15.54 8.46z"/>
                                    </svg>
                                    <div>
                                        <h3>Sound Enabled</h3>
                                        <p>Enable sound for videos</p>
                                    </div>
                                </div>
                                <div class="toggle-switch ${state.settings.soundEnabled ? 'active' : ''}" onclick="toggleSetting('soundEnabled')">
                                    <div class="toggle-slider"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateTheme(theme) {
            state.settings.theme = theme;
            applyTheme();
            renderSettings();
        }

        function toggleSetting(setting) {
            state.settings[setting] = !state.settings[setting];
            renderSettings();
        }

        // Fullscreen Media Viewer
        function openFullscreen(itemId) {
            const item = state.mediaItems.find(i => i.id === itemId);
            if (!item) return;

            state.fullscreenItem = item;
            
            const mediaContainer = document.getElementById('fullscreen-media');
            const audioButton = document.getElementById('fullscreen-audio');
            const controls = document.getElementById('fullscreen-controls');
            
            if (item.type === 'image') {
                mediaContainer.innerHTML = `<img src="${item.url}" alt="${item.name}">`;
                audioButton.classList.add('hidden');
                controls.classList.add('hidden');
            } else {
                mediaContainer.innerHTML = `
                    <video 
                        id="fullscreen-video"
                        src="${item.url}" 
                        autoplay 
                        loop 
                        muted 
                        playsinline
                    ></video>
                `;
                audioButton.classList.remove('hidden');
                controls.classList.remove('hidden');
                setupFullscreenVideoControls();
            }
            
            fullscreenViewer.classList.remove('hidden');
        }

        function closeFullscreen() {
            state.fullscreenItem = null;
            fullscreenViewer.classList.add('hidden');
        }

        function setupFullscreenVideoControls() {
            const video = document.getElementById('fullscreen-video');
            const audioButton = document.getElementById('fullscreen-audio');
            const controls = document.getElementById('fullscreen-controls');
            const currentTime = document.getElementById('current-time');
            const durationTime = document.getElementById('duration-time');
            const seekBar = document.getElementById('seek-bar');
            
            let soundEnabled = false;
            let showControls = true;
            let hideControlsTimer;

            const resetTimer = () => {
                showControls = true;
                controls.classList.remove('hidden');
                clearTimeout(hideControlsTimer);
                hideControlsTimer = setTimeout(() => {
                    showControls = false;
                    controls.classList.add('hidden');
                }, 3000);
            };

            const handleMouseMove = () => resetTimer();
            const handleTouchStart = () => resetTimer();

            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('touchstart', handleTouchStart);
            resetTimer();

            // Audio toggle
            audioButton.onclick = () => {
                soundEnabled = !soundEnabled;
                video.muted = !soundEnabled;
                audioButton.innerHTML = soundEnabled ? `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <path d="m19.07 4.93-1.41 1.41A8.5 8.5 0 0 1 19.07 19.07l1.41 1.41A10.5 10.5 0 0 0 19.07 4.93z"/>
                        <path d="m15.54 8.46-1.41 1.41A4.5 4.5 0 0 1 15.54 15.54l1.41 1.41A6.5 6.5 0 0 0 15.54 8.46z"/>
                    </svg>
                ` : `
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <line x1="23" y1="9" x2="17" y2="15"/>
                        <line x1="17" y1="9" x2="23" y2="15"/>
                    </svg>
                `;
            };

            // Video controls
            video.onclick = () => {
                if (video.paused) {
                    video.play();
                } else {
                    video.pause();
                }
            };

            video.ontimeupdate = () => {
                currentTime.textContent = formatTime(video.currentTime);
                seekBar.value = video.currentTime;
                const progress = (video.currentTime / video.duration) * 100;
                seekBar.style.background = `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${progress}%, #4b5563 ${progress}%, #4b5563 100%)`;
            };

            video.onloadedmetadata = () => {
                durationTime.textContent = formatTime(video.duration);
                seekBar.max = video.duration;
            };

            seekBar.oninput = () => {
                video.currentTime = seekBar.value;
            };

            // Cleanup
            const cleanup = () => {
                clearTimeout(hideControlsTimer);
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('touchstart', handleTouchStart);
            };

            // Store cleanup function for later use
            fullscreenViewer.cleanup = cleanup;
        }

        // View Rendering
        function renderCurrentView() {
            // Hide all views
            feedView.classList.add('hidden');
            reelsView.classList.add('hidden');
            accountView.classList.add('hidden');
            settingsView.classList.add('hidden');

            if (state.showSettings) {
                settingsView.classList.remove('hidden');
                renderSettings();
            } else {
                switch (state.activeTab) {
                    case 'feed':
                        feedView.classList.remove('hidden');
                        renderFeed();
                        break;
                    case 'reels':
                        reelsView.classList.remove('hidden');
                        renderReels();
                        break;
                    case 'account':
                        accountView.classList.remove('hidden');
                        renderAccount();
                        break;
                }
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Navigation
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    setActiveTab(btn.dataset.tab);
                });
            });

            // Back button
            backButton.addEventListener('click', hideSettings);

            // Fullscreen viewer
            document.getElementById('fullscreen-close').addEventListener('click', closeFullscreen);

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (state.activeTab === 'reels') {
                    if (e.key === 'ArrowUp') {
                        goToPreviousReel();
                    } else if (e.key === 'ArrowDown') {
                        goToNextReel();
                    } else if (e.key === ' ') {
                        e.preventDefault();
                        toggleVideoPlayPause();
                    }
                }
                
                if (state.fullscreenItem && e.key === 'Escape') {
                    closeFullscreen();
                }
            });

            // Click outside to close popups
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.feed-more')) {
                    state.showInfoPopup = null;
                    renderCurrentView();
                }
            });

            // Initialize
            applyTheme();
            renderCurrentView();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (fullscreenViewer.cleanup) {
                fullscreenViewer.cleanup();
            }
        });
    </script>
</body>
</html>
